
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber portal family tree</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/seedrandom/3.0.5/seedrandom.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: url('https://www.transparenttextures.com/patterns/white-wall-3.png'), linear-gradient(135deg, #f5f7f5, #e0e8e0);
            margin: 0;
            padding: 0;
            color: #1a3c34;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .top-bar {
            background: #006633;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .top-bar img {
            height: 40px;
        }
        .top-bar .secure {
            font-size: 12px;
            background: #004d29;
            padding: 5px 10px;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }
        .top-bar .secure::before {
            content: 'ğŸ”’';
            margin-right: 5px;
        }
        .developed-by {
            text-align: center;
            padding: 10px;
            background: #fff;
            color: #006633;
            font-size: 14px;
            font-weight: 600;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .header {
            background: #fff;
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #006633;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .header img {
            height: 80px;
            margin-bottom: 10px;
        }
        .header h1 {
            margin: 0;
            font-size: 28px;
            color: #006633;
            font-weight: 700;
            text-transform: uppercase;
        }
        .container {
            max-width: 1100px;
            margin: 30px auto;
            padding: 0 20px;
            flex: 1;
        }
        .search-box {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            margin-bottom: 30px;
            border-left: 5px solid #006633;
        }
        .search-box input[type="text"] {
            padding: 12px;
            width: 70%;
            max-width: 400px;
            border: 2px solid #006633;
            border-radius: 5px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .search-box input[type="text"]:focus {
            border-color: #004d29;
        }
        .search-box button {
            padding: 12px 30px;
            background-color: #006633;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-left: 10px;
            transition: background-color 0.3s ease;
        }
        .search-box button:hover {
            background-color: #004d29;
        }
        .error {
            color: #d32f2f;
            font-size: 16px;
            margin-top: 10px;
            font-weight: 500;
        }
        .family-details {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #006633;
            position: relative;
            overflow: hidden;
        }
        .family-details::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                45deg,
                rgba(0, 102, 51, 0.05),
                rgba(0, 102, 51, 0.05) 10px,
                transparent 10px,
                transparent 20px
            );
            opacity: 0.5;
            z-index: 0;
        }
        .family-details::after {
            content: 'NADRA Official';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            color: rgba(0, 102, 51, 0.1);
            z-index: 0;
            font-weight: 700;
        }
        .family-details .verified {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #006633;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1;
        }
        .family-details .verified::before {
            content: 'âœ”';
            margin-right: 5px;
        }
        .family-details > * {
            position: relative;
            z-index: 1;
        }
        .family-member {
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 0;
            display: flex;
            align-items: center;
        }
        .family-member:last-child {
            border-bottom: none;
        }
        .family-member p {
            margin: 5px 0;
            font-size: 16px;
            line-height: 1.5;
        }
        .family-member p span {
            font-weight: 600;
            color: #006633;
        }
        .family-member .icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #006633;
            border-radius: 50%;
            margin-right: 15px;
        }
        .loading {
            color: #006633;
            font-size: 16px;
            text-align: center;
            margin: 10px 0;
        }
        .whatsapp-channel {
            text-align: center;
            padding: 15px;
            background: #006633;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        .whatsapp-channel a {
            color: white;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
        }
        .whatsapp-channel a::before {
            content: 'ğŸ“±';
            margin-right: 8px;
        }
        .whatsapp-channel a:hover {
            color: #e0e8e0;
        }
        .footer {
            background: #006633;
            color: white;
            padding: 15px 20px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.2);
        }
        .footer img {
            height: 30px;
            vertical-align: middle;
            margin-left: 10px;
        }
        .footer .seal {
            font-size: 12px;
            margin-left: 15px;
            background: #004d29;
            padding: 5px 10px;
            border-radius: 5px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT4Vy8SJO7Z1wTKYQQuRjuNGj3ZkTSg1GhMOEjxDnKDeTRTwCHINjCawVCU8g0JINFvJF4&usqp=CAU" alt="NADRA Logo">
        <div class="secure">Secure Connection</div>
    </div>
    <div class="developed-by">
        Developed by Cyber portal
    </div>
    <div class="header">
        <img src="https://www.nadra.gov.pk/wp-content/uploads/2024/12/pr-image.jpg" alt="NADRA Logo">
        <h1>cyber portal </h1>
    </div>
    <div class="container">
        <div class="search-box">
            <input type="text" id="cnicInput" placeholder="Type CNIC (e.g., 4110123456789 or 41101-2345678-9)">
            <button onclick="generateFamilyTree()">Search</button>
            <div id="errorMessage" class="error"></div>
        </div>
        <div id="loadingMessage" class="loading"></div>
        <div class="family-details" id="familyDetails"></div>
    </div>
    <div class="whatsapp-channel">
        <a href="https://wa.me/+18732864504" target="_blank">owner</a>
    </div>
    <div class="footer">
        Â© 2025 Cyberportal 
        <span class="seal">Powered by cyber portal</span>
        <img src="shadowinnovations.jpg" alt="cyber Innovations">
    </div>

    <script>
        // Function to normalize CNIC format (convert 3630448382899 to 36304-4838289-9)
        function normalizeCnic(cnic) {
            cnic = cnic.replace(/[^0-9]/g, '');
            if (cnic.length !== 13) {
                return null;
            }
            return `${cnic.substring(0, 5)}-${cnic.substring(5, 12)}-${cnic.substring(12)}`;
        }

        // Function to generate a random CNIC
        function generateRandomCnic() {
            const prefix = String(Math.floor(Math.random() * 100000)).padStart(5, '0');
            const second_part = String(Math.floor(Math.random() * 10000000)).padStart(7, '0');
            const last_digit = Math.floor(Math.random() * 10);
            return `${prefix}-${second_part}-${last_digit}`;
        }

        // Function to validate CNIC format
        function validateCnic(cnic) {
            const normalizedCnic = normalizeCnic(cnic);
            if (!normalizedCnic) {
                return { valid: false, message: "Ø¨Ø±Ø§Û Ú©Ø±Ù… 13 ÛÙ†Ø¯Ø³ÙˆÚº ÙˆØ§Ù„Ø§ Ø¯Ø±Ø³Øª CNIC Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº (Ù…Ø«Ø§Ù„ Ú©Û’ Ø·ÙˆØ± Ù¾Ø±ØŒ 4110123456789 ÛŒØ§ 41101-2345678-9)Û”" };
            }
            if (!/^\d{5}-\d{7}-\d$/.test(normalizedCnic)) {
                return { valid: false, message: "ØºÙ„Ø· CNIC ÙØ§Ø±Ù…ÛŒÙ¹Û” Ø¨Ø±Ø§Û Ú©Ø±Ù… Ø¯Ø±Ø³Øª ÙØ§Ø±Ù…ÛŒÙ¹ Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº (xxxxx-xxxxxxx-x)Û”" };
            }
            return { valid: true, normalized: normalizedCnic };
        }

        // Function to generate a random date of birth
        function generateRandomDOB(minYear, maxYear) {
            const day = String(Math.floor(Math.random() * 28) + 1).padStart(2, '0');
            const month = String(Math.floor(Math.random() * 12) + 1).padStart(2, '0');
            const year = Math.floor(Math.random() * (maxYear - minYear + 1)) + minYear;
            return `${day}-${month}-${year}`;
        }

        // Function to generate a random address (in Urdu)
        function generateRandomAddress() {
            const houses = ['281', '45', '12', '93', '304', '102', '56', '78'];
            const streets = ['Ú¯Ù„ÛŒ Ù†Ù…Ø¨Ø± 5', 'Ú¯Ù„ÛŒ Ù†Ù…Ø¨Ø± 12', 'Ú¯Ù„ÛŒ Ù†Ù…Ø¨Ø± 3', 'Ú¯Ù„ÛŒ Ù†Ù…Ø¨Ø± 8', 'Ø³Ù¹Ø±ÛŒÙ¹ 10', 'Ø³Ù¹Ø±ÛŒÙ¹ 15'];
            const areas = ['Ù†Ø§Ø¸Ù… Ø§Ù“Ø¨Ø§Ø¯', 'Ú¯Ù„Ø¨ÛØ§Ø±', 'Ù„ÛŒØ§Ù‚Øª Ø§Ù“Ø¨Ø§Ø¯', 'ÙØ§Ø±ÙˆÙ‚ Ù†Ú¯Ø±', 'Ú¯Ù„Ø´Ù† Ø§Ù‚Ø¨Ø§Ù„', 'ÚˆÛŒÙÙ†Ø³'];
            const cities = ['Ú©Ø±Ø§Ú†ÛŒ', 'Ù„Ø§ÛÙˆØ±', 'Ø§Ø³Ù„Ø§Ù… Ø§Ù“Ø¨Ø§Ø¯', 'Ù¾Ø´Ø§ÙˆØ±', 'Ú©ÙˆØ¦Ù¹Û', 'ÙÛŒØµÙ„ Ø§Ù“Ø¨Ø§Ø¯'];
            const provinces = ['Ø³Ù†Ø¯Ú¾', 'Ù¾Ù†Ø¬Ø§Ø¨', 'Ø®ÛŒØ¨Ø±Ù¾Ø®ØªÙˆÙ†Ø®ÙˆØ§', 'Ø¨Ù„ÙˆÚ†Ø³ØªØ§Ù†'];
            const house = houses[Math.floor(Math.random() * houses.length)];
            const street = streets[Math.floor(Math.random() * streets.length)];
            const area = areas[Math.floor(Math.random() * areas.length)];
            const city = cities[Math.floor(Math.random() * cities.length)];
            const province = provinces[Math.floor(Math.random() * provinces.length)];
            return `ÛØ§Ø¤Ø³ Ù†Ù…Ø¨Ø± ${house}ØŒ ${street}ØŒ ${area}ØŒ ${city}ØŒ ${province}`;
        }

        // Function to generate fake family data based on CNIC
        function generateFamilyData(cnic) {
            console.log("Generating family data for CNIC:", cnic);
            let randomFunc;
            try {
                const seed = cnic.split('-').join('');
                randomFunc = new Math.seedrandom(seed);
                console.log("Seedrandom initialized successfully.");
            } catch (error) {
                console.error("Failed to initialize seedrandom:", error);
                randomFunc = Math.random;
                console.log("Falling back to Math.random.");
            }

            const first_names_male = ["Ø§Ø­Ø³Ø§Ù†", "Ø§Ø­Ù…Ø¯", "Ø¹Ù„ÛŒ", "Ø­Ø³Ù†", "Ø¹Ø«Ù…Ø§Ù†", "Ø¨Ù„Ø§Ù„", "Ø¹Ù…Ø±", "Ø¹Ø¨Ø¯Ø§Ù„Ù„Û"];
            const last_names = ["Ø®Ø§Ù†", "Ù…Ù„Ú©", "Ø±Ø¶Ø§", "Ø­Ø³ÛŒÙ†", "Ø§Ø­Ù…Ø¯", "ØµØ¯ÛŒÙ‚ÛŒ", "Ù‚Ø±ÛŒØ´ÛŒ"];
            const first_names_female = ["ÙØ§Ø·Ù…Û", "Ø¹Ø§Ø¦Ø´Û", "Ø²ÛŒÙ†Ø¨", "Ø«Ù†Ø§Ø¡", "Ù…Ø±ÛŒÙ…", "Ø­Ù†Ø§", "Ø®Ø¯ÛŒØ¬Û", "Ø³Ø¹Ø¯ÛŒÛ"];

            const father_first_name = first_names_male[Math.floor(randomFunc() * first_names_male.length)];
            const father_last_name = last_names[Math.floor(randomFunc() * last_names.length)];
            const father_name = `${father_first_name} Ø§Ù„Ø­Ù‚ ${father_last_name}`;
            const father_dob_year = Math.floor(randomFunc() * (1970 - 1940 + 1)) + 1940;
            const father_dob = generateRandomDOB(father_dob_year, father_dob_year);
            const father_cnic = cnic;
            const father_address = generateRandomAddress();

            const mother_first_name = first_names_female[Math.floor(randomFunc() * first_names_female.length)];
            const mother_last_name = "Ø¨ÛŒÚ¯Ù…";
            const mother_name = `${mother_first_name} ${mother_last_name}`;
            const mother_dob_year = father_dob_year + Math.floor(randomFunc() * 5) + 2;
            const mother_dob = generateRandomDOB(mother_dob_year, mother_dob_year);
            const mother_cnic = generateRandomCnic();
            const mother_address = father_address;

            const children = [];
            const numChildren = Math.floor(randomFunc() * 4);
            const earliestChildYear = mother_dob_year + 18;
            const latestChildYear = Math.min(earliestChildYear + 15, 2010);
            for (let i = 0; i < numChildren; i++) {
                const child_gender = randomFunc() > 0.5 ? 'male' : 'female';
                const child_first_name = child_gender === 'male' ?
                    first_names_male[Math.floor(randomFunc() * first_names_male.length)] :
                    first_names_female[Math.floor(randomFunc() * first_names_female.length)];
                const child_name = `${child_first_name} ${father_last_name}`;
                const child_dob = generateRandomDOB(earliestChildYear, latestChildYear);
                const child_cnic = generateRandomCnic();
                children.push({
                    name: child_name,
                    dob: child_dob,
                    cnic: child_cnic,
                    gender: child_gender,
                    role: child_gender === 'male' ? 'Ø¨ÛŒÙ¹Ø§' : 'Ø¨ÛŒÙ¹ÛŒ'
                });
            }

            const familyData = {
                father: { name: father_name, dob: father_dob, cnic: father_cnic, address: father_address },
                mother: { name: mother_name, dob: mother_dob, cnic: mother_cnic, address: mother_address },
                children: children
            };
            console.log("Generated family data:", familyData);

            // Save the family data to the server
            fetch('', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ cnic: cnic, familyData: familyData }),
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.message || `HTTP error ${response.status}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.status === 'success') {
                        console.log("Family data saved:", data);
                    } else {
                        console.error("Failed to save family data:", data.message);
                    }
                })
                .catch(error => console.error("Error saving family data:", error));

            return familyData;
        }

        // Function to display family tree
        function generateFamilyTree() {
            let cnicInput = document.getElementById('cnicInput').value.trim();
            const errorMessageDiv = document.getElementById('errorMessage');
            const loadingMessageDiv = document.getElementById('loadingMessage');
            const familyDetailsDiv = document.getElementById('familyDetails');

            loadingMessageDiv.textContent = "Ø®Ø§Ù†Ø¯Ø§Ù†ÛŒ ÚˆÛŒÙ¹Ø§ Ù„ÙˆÚˆ ÛÙˆ Ø±ÛØ§ ÛÛ’...";
            familyDetailsDiv.innerHTML = '';
            errorMessageDiv.textContent = '';

            if (cnicInput === '') {
                cnicInput = generateRandomCnic();
                document.getElementById('cnicInput').value = cnicInput;
            }

            const validation = validateCnic(cnicInput);
            if (!validation.valid) {
                errorMessageDiv.textContent = validation.message;
                loadingMessageDiv.textContent = '';
                return;
            }
            const cnic = validation.normalized;
            document.getElementById('cnicInput').value = cnic;

            fetch(`?cnic=${encodeURIComponent(cnic)}`, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                }
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => {
                            throw new Error(err.message || `HTTP error ${response.status}`);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    let familyData;
                    if (data.exists && data.familyData) {
                        familyData = data.familyData;
                        console.log("Loaded existing family data:", familyData);
                    } else {
                        familyData = generateFamilyData(cnic);
                    }

                    familyDetailsDiv.innerHTML = `
                        <div class="verified">Verified by NADRA</div>
                        <div class="family-member">
                            <span class="icon"></span>
                            <div>
                                <p><span>Ø±Ú©Ù†:</span> ÙˆØ§Ù„Ø¯</p>
                                <p><span>Ù†Ø§Ù…:</span> ${familyData.father.name}</p>
                                <p><span>ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ¯Ø§Ø¦Ø´:</span> ${familyData.father.dob}</p>
                                <p><span>CNIC:</span> ${familyData.father.cnic}</p>
                                <p><span>Ù¾ØªÛ:</span> ${familyData.father.address}</p>
                            </div>
                        </div>
                        <div class="family-member">
                            <span class="icon"></span>
                            <div>
                                <p><span>Ø±Ú©Ù†:</span> ÙˆØ§Ù„Ø¯Û</p>
                                <p><span>Ù†Ø§Ù…:</span> ${familyData.mother.name}</p>
                                <p><span>ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ¯Ø§Ø¦Ø´:</span> ${familyData.mother.dob}</p>
                                <p><span>CNIC:</span> ${familyData.mother.cnic}</p>
                                <p><span>Ù¾ØªÛ:</span> ${familyData.mother.address}</p>
                            </div>
                        </div>
                    `;
                    familyData.children.forEach(child => {
                        familyDetailsDiv.innerHTML += `
                            <div class="family-member">
                                <span class="icon"></span>
                                <div>
                                    <p><span>Ø±Ú©Ù†:</span> ${child.role}</p>
                                    <p><span>Ù†Ø§Ù…:</span> ${child.name}</p>
                                    <p><span>ØªØ§Ø±ÛŒØ® Ù¾ÛŒØ¯Ø§Ø¦Ø´:</span> ${child.dob}</p>
                                    <p><span>CNIC:</span> ${c
